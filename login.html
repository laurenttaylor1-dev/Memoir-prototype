<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sign in to Memoir</title>
<meta name="color-scheme" content="light dark" />
<style>
:root{ --bg:#f6f7fb; --card:#fff; --fg:#0f172a; --muted:#667085; --brand:#2563eb; --brand2:#7c3aed; --border:#e6e9f0; --shadow:0 20px 40px rgba(2,8,23,.06), 0 2px 6px rgba(2,8,23,.04); }
@media (prefers-color-scheme:dark){
  :root{ --bg:#0b1020; --card:#0f162e; --fg:#e6edf7; --muted:#9aa4b2; --border:#1f2a44; --shadow:0 20px 40px rgba(0,0,0,.4), 0 2px 6px rgba(0,0,0,.3) }
}
*{box-sizing:border-box}
body{margin:0;min-height:100vh;display:grid;place-items:center;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
.card{width:min(720px,96vw);background:var(--card);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:28px}
h1{display:flex;align-items:center;gap:12px;margin:0 0 16px 0}
.logo{width:40px;height:40px;border-radius:14px;background:conic-gradient(from 180deg, var(--brand), var(--brand2))}
.tabs{display:flex;gap:10px;margin-bottom:14px;flex-wrap:wrap}
.tab{padding:8px 14px;border-radius:999px;border:1px solid var(--border);cursor:pointer;background:transparent}
.tab.active{background:rgba(37,99,235,.1);border-color:rgba(37,99,235,.25)}
.row{display:grid;gap:10px}
input,button{padding:12px;border-radius:12px;border:1px solid var(--border);background:transparent;color:inherit}
button{cursor:pointer}
.btn{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#fff;border:0}
.small{color:var(--muted);font-size:12px}
#error{color:#c02;min-height:1.2em;margin-top:8px}
.hide{display:none}
</style>
</head>
<body>
  <div class="card">
    <h1><span class="logo" aria-hidden="true"></span> Sign in to Memoir</h1>

    <div class="tabs">
      <button id="tabSign"   class="tab active">Sign in</button>
      <button id="tabCreate" class="tab">Create account</button>
      <button id="tabMagic"  class="tab">Magic link</button>
    </div>

    <div id="formSign" class="row">
      <input id="signEmail" type="email" placeholder="Email" autocomplete="username" />
      <input id="signPass"  type="password" placeholder="Password" autocomplete="current-password" />
      <button id="btnSign" class="btn">Sign in</button>
    </div>

    <div id="formCreate" class="row hide">
      <input id="createEmail" type="email" placeholder="Email" autocomplete="username" />
      <input id="createPass"  type="password" placeholder="Password (min 6)" autocomplete="new-password" />
      <button id="btnCreate" class="btn">Create account</button>
    </div>

    <div id="formMagic" class="row hide">
      <input id="magicEmail" type="email" placeholder="Email for magic link" />
      <button id="btnMagic" class="btn">Send magic link</button>
    </div>

    <div id="error"></div>
    <p class="small">By continuing you agree to our terms.</p>
  </div>

  <!-- We’ll use the ESM build so we can import in a module script -->
  <script type="module">
    /***** 1) Supabase constants — filled with your values *****/
    const SUPABASE_URL = "https://jrjqciywljjhhcxfyxwh.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpyanFjaXl3bGlqaGhjeGZ4eXdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ2NzEsImV4cCI6MjA3MTA4MDY3MX0.5FeQxu_N7q-1Br00yJu4E-TKTZK4U4ZnJ4jpRo7Atak";

    /***** 2) Import the SDK and create the client *****/
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    /***** 3) Tiny helpers *****/
    const $ = id => document.getElementById(id);
    const show = (el, ok)=> el.classList.toggle('hide', !ok);
    const setErr = msg => { $('error').textContent = msg || ''; };
    const friendly = (err) => {
      const m = String(err?.message || err || '');
      if (m.includes('Failed to fetch') || m.includes('ERR_NAME_NOT_RESOLVED'))
        return 'Network / URL error. Check Supabase URL or browser extensions/VPN.';
      return m;
    };

    /***** 4) Tabs *****/
    function activate(which){
      ['tabSign','tabCreate','tabMagic'].forEach(id => $(id).classList.remove('active'));
      ['formSign','formCreate','formMagic'].forEach(id => show($(id), false));
      if(which==='sign'){ $('tabSign').classList.add('active'); show($('formSign'), true); }
      if(which==='create'){ $('tabCreate').classList.add('active'); show($('formCreate'), true); }
      if(which==='magic'){ $('tabMagic').classList.add('active'); show($('formMagic'), true); }
      setErr('');
    }
    $('tabSign').onclick   = ()=>activate('sign');
    $('tabCreate').onclick = ()=>activate('create');
    $('tabMagic').onclick  = ()=>activate('magic');

    /***** 5) Actions *****/
    $('btnSign').onclick = async ()=>{
      setErr('');
      try{
        const { error } = await supabase.auth.signInWithPassword({
          email: $('signEmail').value.trim(),
          password: $('signPass').value
        });
        if (error) throw error;
        window.location.replace('index.html');
      }catch(e){ setErr('Error: '+friendly(e)); console.error(e); }
    };

    $('btnCreate').onclick = async ()=>{
      setErr('');
      try{
        const { error } = await supabase.auth.signUp({
          email: $('createEmail').value.trim(),
          password: $('createPass').value
        });
        if (error) throw error;
        // If email confirmations are disabled, you'll be logged in immediately.
        window.location.replace('index.html');
      }catch(e){ setErr('Error: '+friendly(e)); console.error(e); }
    };

    $('btnMagic').onclick = async ()=>{
      setErr('');
      try{
        const { error } = await supabase.auth.signInWithOtp({
          email: $('magicEmail').value.trim(),
          options: { emailRedirectTo: 'https://memoir-prototype.vercel.app/index.html' }
        });
        if (error) throw error;
        setErr('Magic link sent. Check your inbox.');
      }catch(e){ setErr('Error: '+friendly(e)); console.error(e); }
    };

    /***** 6) Quick health probe so URL typos show early *****/
    try{
      const r = await fetch(SUPABASE_URL + '/auth/v1/health', { headers: { apikey: SUPABASE_ANON_KEY }});
      if (!r.ok) throw new Error('Auth health HTTP '+r.status);
    }catch(e){
      setErr('Cannot reach Supabase. Verify the project URL and your network.');
      console.warn('Health check failed:', e);
    }
  </script>
</body>
</html>
