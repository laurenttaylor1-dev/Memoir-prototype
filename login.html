<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Memoir â€” Login</title>
<link rel="stylesheet" href="/styles.css"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.1/dist/umd/supabase.js"></script>
<style>
  .wrap{max-width:520px;margin:0 auto;padding:16px}
  .card{background:#fff;border:1px solid var(--mk-line);border-radius:18px;padding:16px;box-shadow:var(--mk-shadow)}
  .stack{display:grid;gap:10px}
</style>
</head>
<body>
  <div id="header-placeholder"></div>

  <main class="wrap">
    <section class="card">
      <h2 style="margin:0 0 8px">Sign in to Memoir</h2>
      <div class="stack">
        <input id="email" type="email" class="mk-input" placeholder="you@email.com" autocomplete="email">
        <input id="pass" type="password" class="mk-input" placeholder="Password" autocomplete="current-password">
        <button id="login" class="mk-btn mk-primary">Sign in</button>
        <div id="msg" class="mk-sub"></div>
      </div>
    </section>
  </main>

<script>
const SUPABASE_URL = "https://jrjqciywlijhhcxfxywh.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpyanFjaXl3bGlqaGhjeGZ4eXdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ2NzEsImV4cCI6MjA3MTA4MDY3MX0.5FeQxu_N7q-1Br00yJu4E-TKTZK4U4ZnJ4jpRo7Atak";
window.sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {auth:{persistSession:true}});

// Header
fetch('/header.html').then(r=>r.text()).then(html=>{
  document.getElementById('header-placeholder').innerHTML = html;
});

(async function(){
  const { data:{ session } } = await sb.auth.getSession();
  if(session){ location.href='/stories.html'; return; }
})();

async function doLogin(){
  const email = document.getElementById('email').value.trim();
  const pass = document.getElementById('pass').value;
  const msg = document.getElementById('msg'); msg.textContent='';
  if(!email || !pass){ msg.textContent='Enter email and password.'; return; }
  const { error } = await sb.auth.signInWithPassword({ email, password: pass });
  if(error){ msg.textContent = error.message; } else { location.href='/stories.html'; }
}
document.getElementById('login').onclick = doLogin;
document.addEventListener('keydown', (e)=>{ if(e.key==='Enter') doLogin(); });
</script>
</body>
</html>
