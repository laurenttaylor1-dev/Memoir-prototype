<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Memoir — Record</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="bg-cream">
  <div id="site-header"></div>

  <main class="container" style="padding:20px 16px 30px">
    <h1 class="page-title">Record</h1>

    <section class="record-grid card">
      <div class="record-left">
        <button id="recBtn" class="record-circle">Record</button>
        <div id="timer" class="muted" style="margin-top:10px">00:00</div>
      </div>

      <div class="record-right">
        <div class="label-row">
          <div class="label" id="todayLabel">Today's suggested prompts</div>
          <button id="refreshPrompts" class="btn small outline">Suggest other prompts</button>
        </div>
        <div id="promptsWrap" class="chip-row" aria-live="polite"></div>

        <div class="field">
          <label>Notes (optional)</label>
          <textarea id="notes" class="input" rows="3" placeholder="Add a quick note…"></textarea>
        </div>

        <div class="field">
          <label>Title</label>
          <input id="title" class="input" placeholder="Story title"/>
        </div>

        <div class="field">
          <label>When did this happen?</label>
          <input id="when" class="input" placeholder='e.g. "summer 1945", "early 2018", "15 Feb 1972"'/>
        </div>

        <div class="row">
          <button id="saveStory" class="btn primary">Save story</button>
          <a class="btn" href="/stories.html">My Stories</a>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:14px">
      <div class="label">Transcript</div>
      <div id="transcript" class="transcript-area">Your words will appear here…</div>
    </section>
  </main>

  <div id="site-footer"></div>

  <script src="/js/header-loader.js" defer></script>
  <script src="/js/lang.js" defer></script>

  <script>
    // ---- prompts UI ----
    function renderPrompts(code){
      const wrap = document.getElementById('promptsWrap');
      wrap.innerHTML = '';
      const prompts = MEMOIR_I18N.getPrompts(code, 4);
      prompts.forEach(p=>{
        const b = document.createElement('button');
        b.className = 'chip';
        b.textContent = p;
        b.onclick = ()=>{ document.getElementById('title').value = p; };
        wrap.appendChild(b);
      });
      const t = MEMOIR_I18N.strings[code] || MEMOIR_I18N.strings.en;
      document.getElementById('todayLabel').textContent = t.todayPrompts;
      document.getElementById('refreshPrompts').textContent = t.refreshPrompts;
    }

    window.addEventListener('memoir:lang', (e)=>{
      renderPrompts(e.detail.code);
    });

    document.getElementById('refreshPrompts').addEventListener('click', ()=>{
      renderPrompts(MEMOIR_I18N.getLang());
    });

    // initial render
    renderPrompts(MEMOIR_I18N.getLang());

    // ---- dummy recorder (hook yours here) ----
    const recBtn = document.getElementById('recBtn');
    const transcriptEl = document.getElementById('transcript');
    const timerEl = document.getElementById('timer');
    let t=0, ticking=null, recording=false;
    function fmt(s){const m=String(Math.floor(s/60)).padStart(2,'0');const ss=String(s%60).padStart(2,'0');return `${m}:${ss}`;}
    recBtn.onclick = ()=>{
      if (!recording){
        recording = true;
        recBtn.classList.add('pulse');
        recBtn.textContent = 'Stop';
        t = 0; timerEl.textContent = '00:00';
        ticking = setInterval(()=>{ t++; timerEl.textContent = fmt(t); },1000);
        transcriptEl.textContent = 'Listening… (demo placeholder)';
      } else {
        recording = false;
        recBtn.classList.remove('pulse');
        recBtn.textContent = 'Record';
        clearInterval(ticking);
        transcriptEl.textContent = 'Final transcript (demo placeholder).';
      }
    };

    // ---- save handler (wire to Supabase as you already have) ----
    document.getElementById('saveStory').onclick = ()=>{
      alert('Saving… (wire to Supabase create story)');
    };
  </script>
</body>
</html>
