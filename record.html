<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Record — Memoir</title>
<link rel="stylesheet" href="/styles.css">
<link rel="icon" href="data:,">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.1/dist/umd/supabase.js"></script>
</head>
<body>
<nav class="nav">
  <div class="nav-inner container">
    <div class="brand"><div class="logo"></div><div>MEMOIR APP</div></div>
    <div class="nav-links">
      <a href="/index.html" class="link">Home</a>
      <a href="/stories.html" class="link needs-auth">My Stories</a>
      <a href="/login.html" class="link" id="nav-login">Login</a>
      <select id="lang" class="lang">
        <option value="en">🇬🇧 English</option>
        <option value="fr">🇫🇷 Français</option>
        <option value="nl">🇳🇱 Nederlands</option>
        <option value="es">🇪🇸 Español</option>
      </select>
      <span id="userBadge" class="badge hidden"></span>
      <button id="logoutBtn" class="btn pill ghost">Logout</button>
    </div>
  </div>
</nav>

<main class="container">
  <section class="section">
    <div class="card">
      <div class="kicker">Recorder</div>
      <h1 class="center" style="margin-top:6px">Let’s capture a story</h1>
      <p class="center muted">Use the buttons below. The big “Start Recording” opens the high-accuracy Whisper flow.</p>

      <div class="actions-grid" style="margin-top:16px">
        <div class="card">
          <h3>Guided (suggested topics)</h3>
          <div id="guided" class="muted" style="margin:10px 0 12px">Tap one to hear a gentle question.</div>
          <div id="chips" style="display:flex;gap:8px;flex-wrap:wrap"></div>
          <button id="refresh" class="btn pill ghost" style="margin-top:10px">Refresh topics</button>
        </div>

        <div class="card">
          <h3>Free</h3>
          <p class="muted">Speak freely — the recorder will transcribe as you go.</p>
          <a href="/transcribe.html" class="btn pill" style="width:fit-content">Start Recording</a>
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <h3>Library</h3>
        <p class="muted">Browse saved stories, export, or edit later.</p>
        <a href="/stories.html" class="btn pill ghost">Open My Stories</a>
      </div>
    </div>
  </section>
</main>

<script src="/app.js"></script>
<script>
/* Minimal guided topics & spoken prompt (system TTS fallback) */
const TOPIC_WORDS = {
  en:["Childhood","Family","School","Work","Love","War","Travel","Traditions","Holidays","Lessons","Advice","Turning-points"],
  fr:["Enfance","Famille","École","Travail","Amour","Guerre","Voyages","Traditions","Fêtes","Leçons","Conseils","Déclics"],
  nl:["Jeugd","Familie","School","Werk","Liefde","Oorlog","Reizen","Tradities","Feestdagen","Lessen","Advies","Keerpunt"],
  es:["Infancia","Familia","Escuela","Trabajo","Amor","Guerra","Viajes","Tradiciones","Fiestas","Lecciones","Consejos","Puntos-clave"]
};
const PROMPT_SENTENCES = {
  en:{Childhood:"Tell me something about your youth.",Family:"Tell me about your family.",School:"What was school like for you?",Work:"Tell me about your first job.",Love:"How did you meet your partner?",War:"What big events did you live through?",Travel:"Which trip left a mark on you?",Traditions:"Which traditions mattered to you?",Holidays:"Describe a holiday you remember.",Lessons:"What life lesson did you learn?",Advice:"What advice would you give your younger self?","Turning-points":"What was a turning point in your life?"},
  fr:{Enfance:"Parlez-moi de votre jeunesse.",Famille:"Parlez-moi de votre famille.",École:"Comment était l’école pour vous ?",Travail:"Racontez-moi votre premier travail.",Amour:"Comment avez-vous rencontré votre partenaire ?",Guerre:"Quels grands événements avez-vous vécus ?",Voyages:"Quels voyages vous ont marqué(e) ?",Traditions:"Quelles traditions comptaient pour vous ?",Fêtes:"Décrivez une fête mémorable.",Leçons:"Quelle leçon de vie avez-vous apprise ?",Conseils:"Quel conseil donneriez-vous à votre jeune vous ?",Déclics:"Quel déclic a changé votre trajectoire ?"},
  nl:{Jeugd:"Vertel me iets over je jeugd.",Familie:"Vertel over je familie.",School:"Hoe was school voor jou?",Werk:"Vertel over je eerste baan.",Liefde:"Hoe heb je je partner ontmoet?",Oorlog:"Welke grote gebeurtenissen maakte je mee?",Reizen:"Welke reis maakte indruk?",Tradities:"Welke tradities waren belangrijk?",Feestdagen:"Beschrijf een feestdag die je herinnert.",Lessen:"Welke levensles leerde je?",Advies:"Welk advies geef je je jongere zelf?",Keerpunt:"Wat was een keerpunt in je leven?"},
  es:{Infancia:"Cuéntame algo sobre tu juventud.",Familia:"Háblame de tu familia.",Escuela:"¿Cómo era la escuela para ti?",Trabajo:"Cuéntame sobre tu primer trabajo.",Amor:"¿Cómo conociste a tu pareja?",Guerra:"¿Qué grandes eventos viviste?",Viajes:"¿Qué viaje te marcó?",Tradiciones:"¿Qué tradiciones eran importantes para ti?",Fiestas:"Describe una fiesta que recuerdes.",Lecciones:"¿Qué lección de vida aprendiste?",Consejos:"¿Qué consejo le darías a tu yo joven?","Puntos-clave":"¿Cuál fue un punto de inflexión?"}
};
const BCP={en:'en-US',fr:'fr-FR',nl:'nl-NL',es:'es-ES'};

function speak(sentence, code){
  if(!('speechSynthesis' in window)) return;
  const u = new SpeechSynthesisUtterance(sentence);
  u.lang = BCP[code] || 'en-US'; u.rate=.98; speechSynthesis.cancel(); speechSynthesis.speak(u);
}

function renderFour(){
  const code = document.querySelector('#lang')?.value || 'en';
  const pool = [...(TOPIC_WORDS[code]||TOPIC_WORDS.en)];
  // pick 4 different
  const chosen=[];
  while(chosen.length<4 && pool.length){ chosen.push(pool.splice(Math.floor(Math.random()*pool.length),1)[0]); }
  const box = document.getElementById('chips'); box.innerHTML='';
  chosen.forEach(word=>{
    const chip=document.createElement('button');
    chip.className='btn pill ghost'; chip.textContent=word;
    chip.onclick=()=>speak((PROMPT_SENTENCES[code]||{})[word]||word, code);
    box.appendChild(chip);
  });
}
document.getElementById('refresh').onclick=renderFour;
document.getElementById('lang')?.addEventListener('change', renderFour);
renderFour();
</script>
</body>
</html>
