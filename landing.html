<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Memoir App â€” Preserve your memories forever</title>
  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>
  <!-- Header (paste the whole header.html block here) -->
  <!-- START HEADER -->
  <header class="mk-header">
    <div class="mk-brand">
      <div class="mk-logo">ğŸ“–</div>
      <div>
        <div class="mk-title"><strong>MEMOIR APP</strong> â€” Preserve your memories forever</div>
        <div class="mk-sub">Record Â· Transcribe Â· Share privately with family</div>
      </div>
    </div>
    <nav class="mk-nav">
      <a class="mk-chip" href="/landing.html">Home</a>
      <a class="mk-chip" href="/login.html" id="navLogin">Login</a>
      <a class="mk-chip" href="/record.html">Record</a>
      <a class="mk-chip" href="/stories.html">My Stories</a>
      <span class="mk-chip mk-lang">
        <select id="langSelect">
          <option value="en">ğŸ‡ºğŸ‡¸ English</option>
          <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          <option value="nl">ğŸ‡³ğŸ‡± Nederlands</option>
          <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        </select>
      </span>
      <span id="planBadge" class="mk-badge">Plan: â€¦</span>
      <button id="upgradeBtn" class="mk-chip">â¬†ï¸ Upgrade</button>
    </nav>
  </header>
  <!-- END HEADER -->

  <main class="mk-container mk-grid cols-2 mk-hero" style="margin-top:16px">
    <div class="mk-card" style="overflow:hidden">
      <img id="heroImg" src="/assets/book-1.jpg" alt="Open book"/>
    </div>

    <div class="mk-card mk-hero-pane">
      <h1 class="mk-h1">Preserve <span style="color:var(--mk-accent)">Your</span><br/>Memories Forever</h1>
      <p class="mk-muted" style="max-width:42ch">
        Record once, keep for generations. Start a recording in one tap, add a title
        and â€œwhen it happenedâ€, then share safely with your family.
      </p>
      <div style="display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 6px">
        <a class="mk-cta" href="/record.html">Start Recording</a>
        <a class="mk-cta outline" href="/stories.html">View My Stories</a>
      </div>

      <!-- two framed tiles below the hero copy -->
      <div class="mk-grid cols-2" style="margin-top:12px">
        <div class="mk-card mk-feature">
          <h3 class="mk-h2">Start Recording</h3>
          <p class="mk-muted">One tap to begin. Add a title and â€œwhen it happenedâ€ later.</p>
          <a class="mk-cta" href="/record.html">Start Recording</a>
        </div>
        <div class="mk-card mk-feature">
          <h3 class="mk-h2">View My Stories</h3>
          <p class="mk-muted">Browse, rewrite with AI, export, and share with your family.</p>
          <a class="mk-cta outline" href="/stories.html">My Stories</a>
        </div>
      </div>
    </div>
  </main>

  <!-- Features row -->
  <section class="mk-container mk-grid cols-3" style="margin-top:16px">
    <div class="mk-card mk-feature">
      <h3 class="mk-h2">Smart Transcription</h3>
      <p class="mk-muted">Server-side Whisper for accurate EN/FR/NL/ESâ€”even on spotty connections.</p>
    </div>
    <div class="mk-card mk-feature">
      <h3 class="mk-h2">Guided or Free</h3>
      <p class="mk-muted">Use gentle prompts or speak freely. Add a date or period like â€œearly 1970sâ€.</p>
    </div>
    <div class="mk-card mk-feature">
      <h3 class="mk-h2">Private Library</h3>
      <p class="mk-muted">Stories and media saved in your private account. Export when youâ€™re ready.</p>
    </div>
  </section>

  <!-- Pricing -->
  <section class="mk-container" id="pricing" style="margin-top:18px">
    <div class="mk-card mk-feature">
      <h2 class="mk-h2" style="font-size:28px">Pricing</h2>
      <div class="mk-grid cols-2" style="margin-top:8px">
        <div class="mk-card mk-feature">
          <h3 class="mk-h2">Premium â€” â‚¬4.99/month</h3>
          <ul class="mk-muted" style="margin-top:6px">
            <li>All features for a single user</li>
            <li>AI rewrite, export, library</li>
            <li>5-day free trial</li>
          </ul>
          <button class="mk-cta" id="buyPremium">Start 5-day trial</button>
        </div>
        <div class="mk-card mk-feature">
          <h3 class="mk-h2">Family â€” â‚¬7.99/month</h3>
          <ul class="mk-muted" style="margin-top:6px">
            <li>Share with up to 4 family readers</li>
            <li>Everything in Premium</li>
            <li>5-day free trial</li>
          </ul>
          <button class="mk-cta" id="buyFamily">Start 5-day trial</button>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section class="mk-container" id="faq" style="margin:18px 0 24px">
    <div class="mk-card mk-feature">
      <h2 class="mk-h2" style="font-size:28px">FAQ</h2>
      <details style="margin-top:8px"><summary><strong>How do trials work?</strong></summary>
        <p class="mk-muted">Youâ€™ll get full access for 5 days. Cancel anytime in that window to avoid charges.</p>
      </details>
      <details><summary><strong>What happens to my stories if I cancel?</strong></summary>
        <p class="mk-muted">Your stories remain in your account. Premium features are disabled until you re-activate.</p>
      </details>
      <details><summary><strong>How is my data stored?</strong></summary>
        <p class="mk-muted">We use Supabase with row-level security. Only you (and invited readers on Family) can access your stories.</p>
      </details>
    </div>
  </section>

  <footer class="mk-container mk-muted" style="text-align:center; padding:10px 0 24px">
    Â© Memoir App â€” built for families
  </footer>

  <!-- Hero rotation + Upgrade buttons -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    const SUPABASE_URL = "https://jrjqciywlijhhcxfxywh.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpyanFjaXl3bGlqaGhjeGZ4eXdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ2NzEsImV4cCI6MjA3MTA4MDY3MX0.5FeQxu_N7q-1Br00yJu4E-TKTZK4U4ZnJ4jpRo7Atak";
    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Rotate images every 30s
    const imgs = ['/assets/book-1.jpg','/assets/book-2.jpg','/assets/book-3.jpg'];
    let i = 0;
    setInterval(()=>{
      i = (i+1) % imgs.length;
      document.getElementById('heroImg').src = imgs[i];
    }, 30000);

    // Plan badge + upgrade visibility
    async function wirePlan() {
      const { data:{ session } } = await sb.auth.getSession();
      const badge = document.getElementById('planBadge');
      const up = document.getElementById('upgradeBtn');
      const login = document.getElementById('navLogin');

      if (!session) {
        badge.textContent = 'Plan: Free (guest)';
        up.style.display = 'inline-flex';
        return;
      }
      login.textContent = 'Account';

      const { data: prof } = await sb.from('profiles').select('plan, trial_end, seats, role').single();
      const trial = prof?.trial_end ? new Date(prof.trial_end) : null;
      const trialActive = trial && Date.now() < trial.getTime();

      let label = 'Free';
      if (prof?.plan === 'premium') label = 'Premium';
      if (prof?.plan === 'family') label = `Family (${prof?.seats||4})`;
      if (trialActive) label += ` (trial until ${trial.toLocaleDateString()})`;
      if (prof?.role === 'admin') label = 'Admin';

      badge.textContent = `Plan: ${label}`;
      up.style.display = (prof?.plan === 'premium' || prof?.plan === 'family' || prof?.role === 'admin')
        ? 'none' : 'inline-flex';
    }
    wirePlan();

    async function start(plan){
      const { data:{ user } } = await sb.auth.getUser();
      if(!user){ location.href='/login.html'; return; }
      const r = await fetch('/api/create-checkout-session', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ plan, user_id:user.id })
      });
      const j = await r.json();
      if (j.url) location.href = j.url; else alert('Checkout failed');
    }
    document.getElementById('buyPremium')?.addEventListener('click', ()=>start('premium'));
    document.getElementById('buyFamily')?.addEventListener('click', ()=>start('family'));
    document.getElementById('upgradeBtn')?.addEventListener('click', async ()=>{
      const plan = confirm('Choose OK for Premium (â‚¬4.99/mo), Cancel for Family (â‚¬7.99/mo).')
        ? 'premium' : 'family';
      start(plan);
    });
  </script>
</body>
</html>
